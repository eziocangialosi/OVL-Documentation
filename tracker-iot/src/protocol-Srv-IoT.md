# Tracker-Server communication protocol
Exchanges protocol between the tracker and the server throught MQTT
| <i>**Goal of communication**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | **Frame**                                                          | **MQTT topic used** | **Send by**</i> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|-----------------------|---------------|
| **ESTABLISHING A CONNECTION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                      |                       |               |
| Initialize connection with Srv (Begin Hand Check)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `SYN`                                                                | TX                    | Tracker       |
| Confirm connection to tracker (Acknowledge Hand Check)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `SYN-ACK`                                                            | RX                    | Server        |
| Confirm connection is established (Connection established)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `ACK`                                                                | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER STATUS**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                      |                       |               |
| Request status from the tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `STS-RQ`                                                             | RX                    | Server        |
| Sending status to the server (The tracker can send its status without the server asking for it)<br><br>"bat" = battery charge level (in %)<br>"charge" = boolean --> true (1) if the tracker charging, otherwise false (0)<br>"veh_chg" = boolean --> true (1) if the tracker can charge on the vehicle battery, otherwise false (0)<br>"eco-mode" = boolean --> true (1) if the tracker is in eco-mode, otherwise false (0)<br>"protection" = boolean --> true (1) if protection is active, otherwise false (0)<br>"alarm" = boolean --> true (1) if alarm is ringing, otherwise false (0)<br>"gps" = boolean --> true (1) if the tracker can get it position, otherwise false(0) | `STS="bat","charge","veh_chg","eco-mode","protection","alarm","gps"` | TX                    | Tracker       |
| Acknowledge reception of status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `STS-ACK`                                                            | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **PINGING**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                      |                       |               |
| Server ping tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `PING`                                                               | RX                    | Server        |
| Tracker pong to server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `PONG`                                                               | TX                    | Tracker       |
| Tracker ping server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `PING`                                                               | TX                    | Tracker       |
| Server pong to tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `PONG`                                                               | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER POSITION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                      |                       |               |
| Server request tracker position                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `POS-RQ`                                                             | RX                    | Server        |
| Tracker send it position (The tracker can send its status without the server asking for it)<br><br>"lat" = latitude<br>"lon" = longitude                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `POS="lat","lon"`                                                    | TX                    | Tracker       |
| If tracker cannot send it position                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `POS-ERR`                                                            | TX                    | Tracker       |
| Server acknowledge reception of position                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `POS-ACK`                                                            | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER PROTECTION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                      |                       |               |
| Server (des)active the protection<br><br>"state" = true (1) if the tracker moving, it will ring and send a advertissment, otherwise false (0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `PRT="state"`                                                        | RX                    | Server        |
| Tracker acknowledge protection value changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `PRT-ACK`                                                            | TX                    | Tracker       |
| Tracker acknowledge protection value changed but notice that it's limited (due to lack of gps fix)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `PRT-LIM`                                                            | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER ECO-MODE**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                      |                       |               |
| Server (des)active the eco-mode<br><br>"state" = true (1) the tracker will pass in eco-mode, otherwise false (0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `ECO="state"`                                                        | RX                    | Server        |
| Tracker acknowledge eco-mode value changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `ECO-ACK`                                                            | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER CHARGE ON VEHICLE BATTERY**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                      |                       |               |
| Server (des)active the charge on the vehicle battery<br><br>"state" = true (1) the tracker will charge on the vehicle battery, otherwise false (0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `CHG="state"`                                                        | RX                    | Server        |
| Tracker acknowledge charge value changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `CHG-ACK`                                                            | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER SAFE-ZONE**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                      |                       |               |
| Server define the diameter of the safe zone<br><br>"diameter" = diameter of the safe zone in meters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `SFZ="diameter"`                                                     | RX                    | Server        |
| Tracker acknowledge protection value changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `SFZ-ACK`                                                            | TX                    | Tracker       |
| Server ask for safe zone center position                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `SFZ-RQ`                                                             | RX                    | Server        |
| Tracker return safe zone center position<br><br>"lat" = latitude<br>"lon" = longitude                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `SFZ="lat","lon"`                                                    | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER ALARM**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                      |                       |               |
| Tracker notify it is outside the safe-zone, it ringing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `ALM`                                                                | TX                    | Tracker       |
| Server acknowledge alarm notification recived                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `ALM-ACK`                                                            | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **TRACKER REQUEST FOR PARAMETERS**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                      |                       |               |
| Tracker request for it's parameters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `STG-RQ`                                                             | TX                    | Tracker       |
| Server send parameters to tracker (The server can send new parameters without the tracker asking for it)<br><br>"veh_chg" = true (1), the tracker can charge on vehicle battery, otherwise false (0)<br>"eco-mode" = true (1) the tracker will pass in eco-mode, otherwise false (0)<br>"protection" = true (1) if the tracker moving, it will ring and send a advertissment, otherwise false (0)<br>"diameter" = diameter of the safe zone in meters                                                                                                                                                                                                                              | `STG="veh_chg","eco-mode","protection", "diameter"`                  | RX                    | Server        |
| Tracker acknowledge parameters recived                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `STG-ACK`                                                            | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **DEBUG FRAME**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                      |                       |               |
| Tracker or Server indicates a thing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `TXT="<string>"`                                                     | Both                  | Both          |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                      |                       |               |
| **DEFAULT ERROR CODE**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                      |                       |               |
| Tracker or Server cannot handle a frame/request                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `ERR`                                                                | Both                  | Both          |
> Please open an issue if we forget to register/documentate a frame !
